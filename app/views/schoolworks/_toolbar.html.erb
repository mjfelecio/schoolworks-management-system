<div class="section-card">
  <div class="flex flex-col lg:flex-row gap-2 w-full">
    <!-- ==================== -->
    <!-- SEARCH & FILTERS FORM -->
    <!-- ==================== -->
    <%= turbo_search_form_for @q,
        turbo_frame: "schoolworks_list",
        method: :get,
        url: schoolworks_path,
        html: { 
          data: { 
            controller: "search-form",
            action: "turbo:submit-end->search-form#reset"
          },
          class: "contents"
        } do |f| %>
      <!-- ==================== -->
      <!-- SEARCH BAR SECTION -->
      <!-- Uses Ransack's _cont matcher for text search -->
      <!-- ==================== -->
      <div class="w-full lg:w-80 shrink-0">
        <label class="input input-bordered flex items-center gap-2">
          <!-- Search Icon -->
          <svg class="w-4 h-4 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.3-4.3"></path>
            </g>
          </svg>
          <!-- Search Input: searches title and description -->
          <%= f.search_field :title_or_description_cont,
              placeholder: "Search for schoolworks...",
              class: "grow text-sm",
              data: { 
                action: "input->search-form#submit",
                search_form_target: "input"
              } %>
        </label>
      </div>
      <!-- Divider: Hidden on mobile, visible on desktop -->
      <div class="divider lg:divider-horizontal m-0 p-0"></div>
      <!-- ==================== -->
      <!-- FILTERS SECTION -->
      <!-- ==================== -->
      <div class="flex-1">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs font-medium">Subject</span>
            </label>
            <%= f.select :subject_id_eq,
              options_from_collection_for_select(
                Subject.alphabetical, :id, :name, @q.subject_id_eq
              ),
              { include_blank: "All Subjects" },
              class: "select select-bordered select-sm w-full",
              data: { action: "change->search-form#submit" } %>
          </div>
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs font-medium">Type</span>
            </label>
            <%= f.select :schoolwork_type_eq,
              options_for_select(
                Schoolwork.schoolwork_types.map { |k, v| [k.titleize, v] },
                @q.schoolwork_type_eq
              ),
              { include_blank: "All Types" },
              class: "select select-bordered select-sm w-full",
              data: { action: "change->search-form#submit" } %>
          </div>
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs font-medium">Status</span>
            </label>
            <%= f.select :status_eq,
              options_for_select(
                Schoolwork.statuses.map { |k, v| [k.titleize, v] },
                @q.status_eq
              ),
              { include_blank: "All Statuses" },
              class: "select select-bordered select-sm w-full",
              data: { action: "change->search-form#submit" } %>
          </div>
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs font-medium">Priority</span>
            </label>
            <%= f.select :priority_eq,
              options_for_select(
                Schoolwork.priorities.map { |name, value| [name.titleize, value] },
                @q.priority_eq
              ),
              { include_blank: "All Priorities" },
              class: "select select-bordered select-sm w-full",
              data: { action: "change->search-form#submit" } %>
          </div>
        </div>
        <!-- ========================================= -->
        <!-- SORT & ACTION BUTTONS ROW -->
        <!-- ========================================= -->
        <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-end mt-3">
          <div class="form-control w-full sm:flex-1">
            <label class="label py-1">
              <span class="label-text text-xs font-medium">Sort by</span>
            </label>
            <%= f.select :s,
                options_for_select(
                  [
                    ["Recent (Created)", "created_at desc"],
                    ["Due Date (Earliest)", "due_date asc"],
                    ["Due Date (Latest)", "due_date desc"],
                    ["Priority (High to Low)", "priority desc"],
                    ["Priority (Low to High)", "priority asc"],
                    ["Title (A-Z)", "title asc"],
                    ["Title (Z-A)", "title desc"]
                  ],
                  params.dig(:q, :s)
                ),
                { include_blank: "Default Order" },
                class: "select select-bordered select-sm w-full",
                data: { action: "change->search-form#submit" } %>
          </div>
          <!-- ========================================= -->
          <!-- Action Buttons: Submit and Clear -->
          <!-- ========================================= -->
          <div class="flex gap-2 w-full sm:w-auto">
            <%= f.submit "Apply Filters", 
                class: "btn btn-sm btn-primary flex-1 sm:flex-none",
                data: { search_form_target: "submit" } %>
            <%= link_to "Clear All", 
                schoolworks_path, 
                class: "btn btn-sm btn-ghost flex-1 sm:flex-none",
                data: { turbo_frame: "schoolworks_list" } %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>